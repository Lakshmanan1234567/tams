/*!
 * =============================================================
 *
 * Name: Dynamic Form 
 * 
 * Version : 2.0
 * 
 * author: Anand Jeevi
 * 
 * Company: ProPlus Logics
 * 
 * Description : Add Dynamic form fields
 * 
 * (c) 2022 - ProPlus Logics<info@propluslogics.com> (https://propluslogics.com)
 * 
 * =============================================================
 */
!function(t){try{bootbox}catch(t){alert("Dynamic Form is required bootbox.js v4.4.0"),console.log("Dynamic Form is required bootbox.js v4.4.0")}t.fn.dynamicForm=function(e){let a=this,i={Version:"1.0",inputs:[],aligns:["left","center","right"],addButton:null,parentDiv:null,inputDiv:null,dialog:null,InputName:[],DeleteAIDs:[],Images:["png","jpeg","jpg","bmp","gif"],Documents:["pdf","doc","docx"]},n=t.extend({InputTypes:["text","number","date","url","file","email"],FileTypes:["Images","Documents"],ButtonClass:"btn btn-default",allowDuplicateNames:!1,inputDisable:!1,ButtonText:"Add More Fields",ButtonShow:!0,showDownloadButton:!1,RemoveButtonIcon:'<i class="fa fa-trash" aria-hidden="true"></i>',Data:null,BaseUrl:"",FileTypesUrl:"",Columns:12,isValidate:!1,validateStatus:!0},e);_getFileTypes=(async()=>{""!=n.FileTypesUrl&&t.ajax({type:"post",url:n.FileTypesUrl,async:!1,headers:{"X-CSRF-Token":t("meta[name=_token]").attr("content")},success:function(e){t.each(e,function(t,e){null==i[t]&&(i[t]=[]),n.FileTypes.indexOf(t)<0&&(n.FileTypes[n.FileTypes.length]=t),i[t]=e})}})}),is_AllDocuments=(async e=>!!t.inArray(e,i.AllDocuments)),is_Documents=(async e=>!!t.inArray(e,i.Documents)),is_PDF=(async e=>!!t.inArray(e,i.PDF)),is_Images=(async e=>!!t.inArray(e,i.Images)),is_Date=(async t=>"Invalid Date"!=new Date(t)),is_Url=(async t=>/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)),is_Number=(async e=>!!t.isNumeric(e)),is_email=(async t=>{return/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)}),uniqid=(async(t="",e=!1)=>{let a=(Date.now()/1e3).toString(16).split(".").join("");for(;a.length<14;)a+="0";let i="",n=new Date,l=n.getDate()+(n.getMonth()+1)+n.getFullYear()+n.getHours()+n.getMinutes()+n.getSeconds()+n.getMilliseconds();return e&&(i=".",i+=Math.round(1e8*Math.random()*l)),t+a+i}),_append=(async(t,e)=>{e.append(t)}),add_button=(async e=>{if(1==n.ButtonShow){let a=document.createElement("button"),i=await uniqid("bt");e.append(a),a.setAttribute("id",i),a.setAttribute("type","button"),a.innerHTML=n.ButtonText,a.classList.add("addMoreFields"),a.style.textAlign="center",t("#"+i).addClass(n.ButtonClass)}}),createDiv=(async(e,a,i)=>{let n=document.createElement("div");return i.append(n),n.setAttribute("id",e),Array.isArray(a)?a.length>0&&t("#"+e).addClass(a.join(" ")):""!=a&&t("#"+e).addClass(a),n}),add_input=(async(e,a,l,u,s=null,d=null,r=0)=>{null==s&&(s=await uniqid("txt"));let o={id:s,name:e,ColName:e,isRequired:r,value:"",type:a,dType:l,value:"",fileName:"",fileSize:"",fileType:""};null!=d&&null!=d&&(o.aid=d),i.inputs[i.inputs.length]=o;let p=await uniqid("div"),m=12;n.Columns<=12&&n.Columns>=1&&(m=Math.round(12/n.Columns));let c=document.createElement("div");await _append(c,i.inputDiv),c.classList.add("col-sm-"+m),c.setAttribute("id",p),c.classList.add("inputRow");let F=document.createElement("div");await _append(F,c),F.classList.add("form-group");let y=document.createElement("label");await _append(y,F),y.setAttribute("for",s);let f="";1==r&&(f+=' <span class="required"> * </span>'),y.innerHTML=e+f;let D=document.createElement("input");if(await _append(D,F),D.setAttribute("type",a),D.setAttribute("id",s),D.setAttribute("name",s),D.setAttribute("placeholder",e),D.classList.add("form-control"),"file"!=a&&(D.value=u),"number"==a&&D.setAttribute("step","0.01"),null!=d&&null!=d&&D.setAttribute("data-aid",d),"file"==a?(i[l].length>0&&(D.setAttribute("data-allowed-file-extensions",i[l].join(" ").replace("image/","")),D.setAttribute("accept","."+i[l].join(",."))),""!=u&&(u=n.BaseUrl+u),D.setAttribute("data-default-file",u),D.classList.add("dropify"),D.classList.add("dynamicForm-dropify"),1==n.inputDisable&&D.setAttribute("disabled","disabled"),t("#"+s).dropify(),1==n.showDownloadButton&&t("#"+p).append('<center><a target="_blank" href="'+u+'" class="btn btn-float  btn-pink"><i class="fa fa-cloud-download"></i></a></center>')):1==n.inputDisable&&D.setAttribute("disabled",!0),0==n.inputDisable){let t=document.createElement("span");await _append(t,c),t.classList.add("input-remove"),t.innerHTML=n.RemoveButtonIcon,t.setAttribute("data-id",s)}let g=document.createElement("span");await _append(g,F),g.classList.add("errors"),g.classList.add("dyerrors"),g.setAttribute("id",s+"-err")}),loadData=(async t=>{if(null!=t&&null!=t.inputs)if(Array.isArray(t.inputs)){if(null!=t.inputs.length){let e=0;for(let a=0;a<t.inputs.length;a++){let n=0;null!=(e=t.inputs[a]).isRequired&&(n=e.isRequired),await add_input(e.name,e.type,e.dType,e.value,e.id,e.aid,n),i.InputName[i.InputName.length]=e.name}}}else alert("data not valid")}),validate=(async e=>{let a=!0,n="",l="",u="",s="",d="";for(let r=0;r<i.inputs.length;r++)if(e==i.inputs[r].id){n=i.inputs[r].id,l=i.inputs[r].type,u=i.inputs[r].dType,s=i.inputs[r].name;let e=i.inputs[r].isRequired,o="";d=document.getElementById(i.inputs[r].id).value,"file"==l?(o=document.getElementById(i.inputs[r].id).getAttribute("data-default-file").toString().trim(),""==d&&""!=o&&(d=o)):o=d,t("#"+n+"-err").html(""),1==e&&""==d&&""==o?(t("#"+n+"-err").html(s+" is required"),a=!1):""!=d&&("date"==l?0==await is_Date(d)&&(t("#"+n+"-err").html(s+" is not valid  Date"),a=!1):"number"==l?0==await is_Number(d)&&(t("#"+n+"-err").html(s+" is not valid  number"),a=!1):"email"==l?0==await is_email(d)&&(t("#"+n+"-err").html("E-Mail Address not valid"),a=!1):"url"==l?0==await is_Url(d)&&(t("#"+n+"-err").html(s+" is not valid  url"),a=!1):"file"==l&&("Image"==u?0==await is_Images(d)&&(t("#"+n+"-err").html("Image format not supported. "+i.Images.join(",")+" formats only accepted"),a=!1):"Pdf"==u?0==await is_PDF(d)&&(t("#"+n+"-err").html("Document format not supported. "+i.PDF.join(",")+" format only accepted"),a=!1):"Douments"==u?0==await is_Documents(d)&&(t("#"+n+"-err").html("Document format not supported. "+i.Documents.join(",")+" formats only accepted"),a=!1):"all"==u&&0==await is_AllDocuments(d)&&(t("#"+n+"-err").html("Document format not supported. "+i.AllDocuments.join(",")+" formats only accepted"),a=!1)))}return a}),validateAll=(async()=>{t(".dyerrors").html("");let e=!0,a="",l="",u="",s="",d="";for(let n=0;n<i.inputs.length;n++){a=i.inputs[n].id,l=i.inputs[n].type,u=i.inputs[n].dType,s=i.inputs[n].name;let r=i.inputs[n].isRequired,o="";null!=document.getElementById(i.inputs[n].id)&&(d=document.getElementById(i.inputs[n].id).value,"file"==l?(o=document.getElementById(i.inputs[n].id).getAttribute("data-default-file").toString().trim(),""==d&&""!=o&&(d=o)):o=d,1==r&&""==d&&""==o?(t("#"+a+"-err").html(s+" is required"),e=!1):""!=d&&("date"==l?0==await is_Date(d)&&(t("#"+a+"-err").html(s+" is not valid  Date"),e=!1):"number"==l?0==await is_Number(d)&&(t("#"+a+"-err").html(s+" is not valid  number"),e=!1):"email"==l?0==await is_email(d)&&(t("#"+a+"-err").html("E-Mail Address not valid"),e=!1):"url"==l?0==await is_Url(d)&&(t("#"+a+"-err").html(s+" is not valid  url"),e=!1):"file"==l&&("Image"==u?0==await is_Images(d)&&(t("#"+a+"-err").html("Image format not supported. "+i.Images.join(",")+" formats only accepted"),e=!1):"Pdf"==u?0==await is_PDF(d)&&(t("#"+a+"-err").html("Document format not supported. "+i.PDF.join(",")+" format only accepted"),e=!1):"Douments"==u?0==await is_Documents(d)&&(t("#"+a+"-err").html("Document format not supported. "+i.Documents.join(",")+" formats only accepted"),e=!1):"all"==u&&0==await is_AllDocuments(d)&&(t("#"+a+"-err").html("Document format not supported. "+i.AllDocuments.join(",")+" formats only accepted"),e=!1))))}return n.validateStatus=e,e});var l={getVersion:async()=>i.Version,drawData:async t=>{await loadData(t)},getFieldID:async()=>{let t=[];for(let e=0;e<i.inputs.length;e++)t[t.length]=i.inputs[e].id;return t},getFormData:async()=>{let t=new FormData,e=[],a=[];for(let n=0;n<i.inputs.length;n++)null!=document.getElementById(i.inputs[n].id)&&("file"!=i.inputs[n].type?i.inputs[n].value=document.getElementById(i.inputs[n].id).value:""!=document.getElementById(i.inputs[n].id).value&&t.append(i.inputs[n].id,document.getElementById(i.inputs[n].id).files[0]),a[a.length]=parseInt(i.inputs[n].fileSize),e[e.length]={name:i.inputs[n].name,value:i.inputs[n].value,aid:i.inputs[n].aid,fileName:i.inputs[n].fileName,fileType:i.inputs[n].fileType,fileSize:i.inputs[n].fileSize});return t},getData:async()=>{let t=new FormData,e=[],a=[];for(let l=0;l<i.inputs.length;l++)null!=document.getElementById(i.inputs[l].id)&&("file"!=i.inputs[l].type?i.inputs[l].value=document.getElementById(i.inputs[l].id).value:""!=document.getElementById(i.inputs[l].id).value?t.append(i.inputs[l].id,document.getElementById(i.inputs[l].id).files[0]):""!=document.getElementById(i.inputs[l].id).getAttribute("data-default-file")&&(i.inputs[l].value=document.getElementById(i.inputs[l].id).getAttribute("data-default-file").replace(n.BaseUrl,"")),a[a.length]=parseInt(i.inputs[l].fileSize),e[e.length]={name:i.inputs[l].name,ColName:i.inputs[l].ColName,value:i.inputs[l].value,isRequired:i.inputs[l].isRequired,dType:i.inputs[l].dType,aid:i.inputs[l].aid,fileName:i.inputs[l].fileName,fileType:i.inputs[l].fileType,fileSize:i.inputs[l].fileSize});return{inputs:i.inputs,data:e,DeletedItems:i.DeleteAIDs,fileSize:a,validateStatus:n.validateStatus}},getValidateStatus:async()=>n.validateStatus,Validate:async()=>validateAll()};return t(document).on("keyup","input",function(){let e=t(this).attr("id");1==n.isValidate&&validate(e)}),t(document).on("change","input",function(){let e=t(this).attr("id");1==n.isValidate&&validate(e)}),t(document).on("click",".input-remove",function(){let e=t(this).attr("data-id"),a=t('label[for="'+e+'"]').html().toString().replace(' <span class="required"> * </span>',""),n=t("#"+e).attr("data-aid"),l=t("#"+e).attr("type"),u=[];for(let t=0;t<i.inputs.length;t++)i.inputs[t].id!=e&&(u[u.length]=i.inputs[t]);let s=[];for(let t=0;t<i.InputName.length;t++)i.InputName[t]!=a&&(s[s.length]=i.InputName[t]);i.inputs=u,i.InputName=s,null!=n&&""!=n&&(i.DeleteAIDs[i.DeleteAIDs.length]={AID:n,type:l}),t('span[data-id="'+e+'"]').parent().remove()}),t(document).on("change",".dynamicForm-dropify",function(){let e=t(this).attr("id");var a=document.getElementById(e);for(let t=0;t<i.inputs.length;t++)i.inputs[t].id==e&&(i.inputs[t].fileName=a.files[0].name,i.inputs[t].fileSize=a.files[0].size,i.inputs[t].fileType=a.files[0].type)}),t(document).on("click",".addMoreFields",function(){let t='<option value="">--Select Input Type--</option>';for(let e=0;e<n.InputTypes.length;e++)if("file"==n.InputTypes[e])for(let a=0;a<n.FileTypes.length;a++)t+='<option data-type="'+n.FileTypes[a]+'"  value="'+n.InputTypes[e]+'">'+n.FileTypes[a]+"</option>";else t+='<option value="'+n.InputTypes[e]+'">'+n.InputTypes[e]+"</option>";let e='<div class="row"><div class="col-sm-12"><div class="form-group"><label for="inputName">Name  <span class="required">*</span></label><input type="text" id="inputName" class="form-control"><span class="errors" id="inputName-err"></span></div></div><div class="col-sm-12"><div class="form-group"><label for="lstInputType">Input Type  <span class="required">*</span></label><select id="lstInputType" name="lstInputType" class="form-control" >'+t+'</select><span class="errors" id="lstInputType-err"></span></div></div></div><div class="row d-flex justify-content-center"><div class="col-sm-6"><div class="form-check"><input type="checkbox" checked class="form-check-input" id="chkisRequired"><label class="form-check-label" for="chkisRequired">is Required</label></div></div></div><div class="row"><div class="bt col-sm-12 text-right"><button class="btn btn-default" id="btCancel">Cancel</button><button class="bt btn btn-success" id="btAdd">Add</button></div></div>';i.dialog=bootbox.dialog({title:"",closeButton:!0,message:e,buttons:{}})}),t(document).on("click","#btAdd",function(){if(null!=i.dialog){let e=!0,a=0,l=t("#lstInputType").val(),u=t("#lstInputType option:selected").attr("data-Type"),s=t("#inputName").val();1==t("#chkisRequired").prop("checked")&&(a=1),""==s?(t("#inputName-err").html("name is required"),e=!1):s.length<3?(t("#inputName-err").html("name must be at least 3 characters"),e=!1):s.length>50?(t("#inputName-err").html("name not be greater than 50 characters"),e=!1):0==n.allowDuplicateNames&&t.inArray(s,i.InputName)>=0?(t("#inputName-err").html("Name is already taken"),e=!1):t("#inputName-err").html(""),""==l?(t("#lstInputType-err").html("please select input type"),e=!1):t.inArray(l,n.InputTypes)<0?(t("#lstInputType-err").html("input type not valid"),e=!1):t("#lstInputType-err").html(""),1==e&&(t("#lstInputType-err").html(""),i.dialog.modal("hide"),i.dialog=null,i.InputName[i.InputName.length]=s,add_input(s,l,u,"",null,null,a))}}),t(document).on("click","#btCancel",function(){null!=i.dialog&&(i.dialog.modal("hide"),i.dialog=null)}),init=(async()=>{await _getFileTypes(),i.parentDiv=await createDiv(await uniqid("div"),"dynamic-Form",a),i.inputDiv=await createDiv(await uniqid("div"),[],i.parentDiv),await i.inputDiv.classList.add("row"),await i.inputDiv.classList.add("input-Form"),await i.inputDiv.classList.add("text-left"),i.addButton=await add_button(i.parentDiv),setTimeout(async function(){await loadData(n.Data)},0)}),init(),l}}(jQuery);